# description	: OpenGL compatible 3D graphics library
# depends : xorg-libraries libdrm python-mako python-yaml libva libvdpau llvm wayland-protocols gslang cbindgen make-ca rust-cbindgen libclc

name=mesa
version=25.1.3
release=1
source="https://mesa.freedesktop.org/archive/$name-$version.tar.xz
	https://www.linuxfromscratch.org/patches/blfs/svn/mesa-add_xdemos-4.patch"

options="!checksum"
build() {
	cd $name-$version
	patch -Np1 -i $SRC/mesa-add_xdemos-4.patch
	
	mkdir build &&
	cd    build &&
meson setup ..                 \
      --prefix=$XORG_PREFIX    \
      --buildtype=release      \
      -D platforms=x11,wayland \
      -D gallium-drivers=auto \
      -D vulkan-drivers=auto   \
      -D valgrind=disabled     \
      -D video-codecs=all      \
      -D libunwind=disabled      	
	ninja
	DESTDIR=$PKG ninja install

	# indirect rendering symlink
	#ln -s libGLX_mesa.so.0 $PKG/usr/lib/libGLX_indirect.so.0
}
